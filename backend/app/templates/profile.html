{% extends "layout.html" %}

{% block title %}Профиль — А-Компания{% endblock %}
{% block crumb %}Профиль{% endblock %}

{% block content %}
<div class="page-head page-head--between">
    <div>
        <h1 class="h1-tight">Профиль</h1>
        <div class="page-head-hint">Настройки пользователя для демонстрации ролей и структуры подчинения.</div>
    </div>
    <a class="btn btn--outline" href="/certification">← К сертификатам</a>
</div>

{% if request.query_params.get('saved') %}
<div class="notice">Сохранено ✅</div>
{% endif %}

<section class="card">
    <form method="post" action="/profile" class="profile-form">
        <label class="form-field">
            <span>ФИО</span>
            <input name="full_name" type="text" value="{{ profile.full_name }}" required />
        </label>

        <label class="form-field">
            <span>Должность</span>
            <input name="position" type="text" value="{{ profile.position }}" required />
        </label>

        <label class="form-field">
            <span>Модуль</span>
            <select name="module" required>
                {% for m in modules %}
                <option value="{{ m }}" {% if profile.module == m %}selected{% endif %}>{{ m }}</option>
                {% endfor %}
            </select>
        </label>

        <label class="form-field">
            <span>Непосредственный руководитель</span>
            <select name="manager_id">
                <option value="">—</option>
                {% for u in users %}
                {% if u.id != user.id %}
                <option value="{{ u.id }}" {% if profile.manager_id == u.id %}selected{% endif %}>{{ u.full_name }} — {{ u.role_label }}</option>
                {% endif %}
                {% endfor %}
            </select>
        </label>

        {% if user.role == 'hr' %}
        <label class="form-field">
            <span>Подконтрольный модуль</span>
            <select name="controlled_module">
                <option value="">—</option>
                {% for m in modules %}
                <option value="{{ m }}" {% if profile.controlled_module == m %}selected{% endif %}>{{ m }}</option>
                {% endfor %}
            </select>
        </label>
        {% else %}
        <input type="hidden" name="controlled_module" value="" />
        {% endif %}

        <div class="modal-actions">
            <button class="btn btn--primary" type="submit">Сохранить</button>
            <a class="btn" href="/">Отмена</a>
        </div>
    </form>
</section>
{% endblock %}
