{% extends "layout.html" %}

{% block title %}Сертификаты — А-Компания{% endblock %}
{% block crumb %}Сертификаты{% endblock %}

{% block content %}
<div class="page-head page-head--stack">
    <h1>Сертификаты</h1>
    <div class="tabs-row">
        <div class="tabs" role="tablist" aria-label="Разделы сертификатов">
            <button class="tab tab--active" type="button" data-tab="my" role="tab" aria-selected="true">Мои сертификаты</button>
            <button class="tab" type="button" data-tab="team" role="tab" aria-selected="false">Сертификаты сотрудников</button>
        </div>
        <button class="btn btn--primary btn--add" id="addCertBtn" type="button" aria-label="Добавить сертификат">+ Добавить сертификат</button>
    </div>
</div>

<!-- Мои сертификаты -->
<div class="tab-panel tab-panel--active" id="tab-my" data-tabpanel="my">
    <div class="my-toolbar" id="myFiltersBar">
        <div class="my-filters">
            <div class="my-filter-group">
                <div class="my-filter-label">Тип</div>
                <div class="my-filter-pills">
                    <label class="filter-pill"><input type="checkbox" id="myShowInternal" checked><span>Внутренние</span></label>
                    <label class="filter-pill"><input type="checkbox" id="myShowExternal" checked><span>Внешние</span></label>
                </div>
            </div>
            <div class="my-filter-group">
                <div class="my-filter-label">Статус</div>
                <div class="my-filter-pills">
                    <label class="filter-pill"><input type="checkbox" id="myShowValid" checked><span>Действительны</span></label>
                    <label class="filter-pill"><input type="checkbox" id="myShowPassed" checked><span>Экзамен сдан</span></label>
                    <label class="filter-pill"><input type="checkbox" id="myShowPending" checked><span>Ожидают экзамен</span></label>
                    <label class="filter-pill"><input type="checkbox" id="myShowFailed" checked><span>Экзамен не сдан</span></label>
                    <label class="filter-pill"><input type="checkbox" id="myShowExpired" checked><span>Просрочены</span></label>
                    <label class="filter-pill"><input type="checkbox" id="myShowRevoked" checked><span>Отозваны</span></label>
                </div>
            </div>
        </div>
        <div class="my-stats" aria-label="Сводка по сертификатам">
            <div class="stat-pill">Показано: <strong id="myShownCount">0</strong></div>
            <div class="stat-pill stat-pill--primary">Действительны: <strong id="myValidCount">0</strong></div>
        </div>
    </div>

    <div class="cert-empty" id="certEmpty" style="display:none;">Пока нет сертификатов. Нажмите “+ Добавить сертификат”, чтобы добавить.</div>
    <div class="section" id="myInternalSection">
        <h2 class="section-title">Внутренние сертификаты</h2>
        <div class="cert-empty" id="myInternalEmpty" style="display:none;">Нет внутренних сертификатов.</div>
        <section class="cert-grid cert-grid--my" id="myInternalList"></section>
    </div>

    <div class="section" id="myExternalSection">
        <h2 class="section-title">Внешние сертификаты</h2>
        <div class="cert-empty" id="myExternalEmpty" style="display:none;">Нет внешних сертификатов.</div>
        <section class="cert-grid cert-grid--my" id="myExternalList"></section>
    </div>

    <div class="section">
        <div class="section-head">
            <h2 class="section-title">Запросы на экзамен</h2>
        </div>
        <div class="cert-empty" id="reqEmpty" style="display:none;">Нет запросов на экзамен.</div>
        <section class="cert-grid" id="reqList"></section>
    </div>
</div>

<!-- Сертификаты сотрудников -->
<div class="tab-panel" id="tab-team" data-tabpanel="team">
    <div class="toolbar">
        <input class="search-input" id="teamSearch" type="text" placeholder="Поиск по ФИО, сертификату, профилю" />
        <select class="select-sm" id="teamModuleFilter">
            <option value="all">Все модули</option>
        </select>
        <select class="select-sm" id="teamGradeFilter">
            <option value="all">Все грейды</option>
        </select>
        <select class="select-sm" id="teamFilter">
            <option value="all">Все статусы</option>
            <option value="pending_exam">Ожидают экзамен</option>
            <option value="passed">Экзамен сдан</option>
            <option value="failed">Экзамен не сдан</option>
            <option value="revoked">Отозваны</option>
            <option value="valid">Действительны</option>
            <option value="expired">Просрочены</option>
        </select>
        <select class="select-sm" id="teamExpiryFilter">
            <option value="all">Все сроки</option>
            <option value="perpetual">Бессрочные</option>
            <option value="with_expiry">Со сроком</option>
            <option value="expiring_soon">Истекают скоро</option>
        </select>
        <button class="btn btn--outline" id="exportTeamCsvBtn" type="button">Экспорт CSV</button>
    </div>

    <div class="form-hint" id="teamScopeHint" style="display:none;"></div>
    <div class="cert-empty" id="teamEmpty" style="display:none;"></div>

    <div class="cert-table-wrap" id="teamTableWrap" style="display:none;">
        <table class="cert-table" id="teamTable">
            <thead>
                <tr>
                    <th class="th-sortable" data-sort="id">№</th>
                    <th>Тип</th>
                    <th>Сотрудник</th>
                    <th>Грейд</th>
                    <th>Модуль</th>
                    <th>Сертификат</th>
                    <th class="th-sortable" data-sort="dates">Даты</th>
                    <th class="th-sortable" data-sort="status">Статус</th>
                    <th>Оценка</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="teamTableBody"></tbody>
        </table>
    </div>
    <div class="cert-empty" id="teamTableEmpty" style="display:none;"></div>
</div>

<!-- Добавление сертификата -->
<div class="modal" id="certModal" aria-hidden="true">
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="certModalTitle">
        <div class="modal-header">
            <h2 id="certModalTitle">Добавить сертификат</h2>
            <button class="modal-close" type="button" data-close="1">✕</button>
        </div>
        <form id="certForm" class="modal-form">
            <div class="radio-row">
                <label class="radio-pill">
                    <input type="radio" name="cert_type" value="internal" checked />
                    <span>Внутренний</span>
                </label>
                <label class="radio-pill">
                    <input type="radio" name="cert_type" value="external" />
                    <span>Внешний</span>
                </label>
            </div>

            <label class="form-field" id="topicField">
                <span>Профиль сдачи</span>
                <select name="topic">
                    <option value="Корпоративная культура">Корпоративная культура</option>
                    <option value="Оказание первой помощи">Оказание первой помощи</option>
                </select>
            </label>
            <div class="form-hint" id="examHint" style="display:none;"></div>

            <label class="form-field">
                <span>Название</span>
                <input name="name" type="text" placeholder="Например: Сертификат" required />
            </label>
            <div class="form-row">
                <label class="form-field">
                    <span>Дата выдачи</span>
                    <input name="issued_at" type="date" required />
                </label>
                <label class="form-field" id="expiresField">
                    <span>Действителен до</span>
                    <input name="expires_at" type="date" />
                </label>
            </div>
            <div class="radio-row" style="margin-top:6px;">
                <label class="radio-pill">
                    <input type="checkbox" name="is_perpetual" id="isPerpetualCertAdd" checked />
                    <span>Бессрочный</span>
                </label>
            </div>
            <div class="modal-actions">
                <button class="btn btn--primary" type="submit">Готово</button>
                <button class="btn" type="button" data-close="1">Отмена</button>
            </div>
            <div class="form-error" id="certFormError" aria-live="polite"></div>
        </form>
    </div>
</div>

<!-- Оценка (экзамен) -->
<div class="modal" id="examModal" aria-hidden="true">
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="examModalTitle">
        <div class="modal-header">
            <h2 id="examModalTitle">Результат экзамена</h2>
            <button class="modal-close" type="button" data-close="1">✕</button>
        </div>
        <form id="examForm" class="modal-form">
            <input type="hidden" name="cert_id" />
            <div class="form-hint" id="examTargetHint"></div>
            <div class="form-row">
                <label class="form-field">
                    <span>Оценка</span>
                    <select name="exam_grade" required>
                        <option value="Hard">Hard</option>
                        <option value="Standart">Standart</option>
                        <option value="Light">Light</option>
                        <option value="Не сдан">Не сдан</option>
                    </select>
                </label>
                <label class="form-field">
                    <span>Дата сдачи</span>
                    <input name="exam_date" type="date" required />
                </label>
            </div>
            <div class="modal-actions">
                <button class="btn btn--primary" type="submit">Сохранить</button>
                <button class="btn" type="button" data-close="1">Отмена</button>
            </div>
            <div class="form-error" id="examFormError" aria-live="polite"></div>
        </form>
    </div>
</div>

<!-- Отзыв сертификата (HR) -->
<div class="modal" id="revokeModal" aria-hidden="true">
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="revokeModalTitle">
        <div class="modal-header">
            <h2 id="revokeModalTitle">Отозвать сертификат</h2>
            <button class="modal-close" type="button" data-close="1">✕</button>
        </div>
        <form id="revokeForm" class="modal-form">
            <input type="hidden" name="cert_id" />
            <div class="form-hint" id="revokeTargetHint"></div>
            <label class="form-field">
                <span>Причина отзыва</span>
                <textarea name="reason" rows="4" placeholder="Например: данные не подтверждены / истёк регламент / ошибка оформления" required></textarea>
            </label>
            <div class="modal-actions">
                <button class="btn btn--danger" type="submit">Отозвать</button>
                <button class="btn" type="button" data-close="1">Отмена</button>
            </div>
            <div class="form-error" id="revokeFormError" aria-live="polite"></div>
        </form>
    </div>
</div>

{% endblock %}
